<!DOCTYPE html>
<meta charset="utf-8" />
<script src="https://d3js.org/d3.v4.js"></script>
<div id="graph"></div>

<style>
    text {
        font-family: "Comic Sans MS", "Papyrus", sans-serif;
        font-size: 32px;
        font-weight: bold;
        fill: red;
    }

    circle {
        fill: #69b3a2;
        stroke-width: 2;
    }

    path {
        fill: none;
        stroke-width: 4;
    }
</style>

<script>
    const width = window.innerWidth;
    const height = window.innerHeight;
    const data = JSON.parse(`{{{dataNode}}}`);

    const svg = d3
        .select("#graph")
        .append("svg")
        .call(
            d3.zoom().on("zoom", function () {
                svg.attr("transform", d3.event.transform);
            })
        )
        .attr("width", width)
        .attr("height", height)
        .attr("transform", "translate(40,0)")
        .append("g");

    const cluster = d3.cluster().size([height, width - 100]);
    const root = d3.hierarchy(data, function (d) {
        return d.children;
    });

    cluster(root);

    svg.append("g")
        .selectAll("path")
        .data(root.descendants().slice(1))
        .enter()
        .append("path")
        .attr("d", function (d) {
            return (
                "M" +
                d.y +
                "," +
                d.x +
                "C" +
                (d.parent.y + 50) +
                "," +
                d.x +
                " " +
                (d.parent.y + 150) +
                "," +
                d.parent.x +
                " " +
                d.parent.y +
                "," +
                d.parent.x
            );
        })
        .attr("stroke", "#ccc");

    svg.append("g")
        .selectAll("g")
        .data(root.descendants())
        .enter()
        .append("g")
        .attr("transform", function (d) {
            return "translate(" + d.y + "," + d.x + ")";
        })
        .append("circle")
        .attr("r", 15)
        .attr("stroke", "black")
        .select(function () {
            return this.parentNode;
        })
        .append("text")
        .text((d) => `${d.data.name} = ${d.data.returns}`);
</script>
